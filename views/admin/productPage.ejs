<%- include('../layouts/adminHeader')  %>


        <!-- partial -->
        <div class="main-panel">
          <div class="content-wrapper">
            <div class="page-header">
              <h3 class="page-title"> Product Tables </h3>

              <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <button> <li class="breadcrumb-item"><a href="addProduct">Add Product</a></li></button>
                
                </ol>
              </nav>
            </div>
            <div class="row">
        

              <div class="col-lg-12 grid-margin stretch-card">
                <div class="card">
                  <div class="card-body">
                  
                   
                    </p>
                    <div class="table-responsive">
                          <table class="table table-dark" style="color: white;">
                              <thead>
                                <tr>
                                  <th>No</th>
                                  <th>Product Name</th>
                                  <th>Category</th>
                                  <th>Price</th>
                                  <!-- <th>Description</th> -->
                                  <th>Offer Price</th>
                                  <th>Quantity</th>
                                  <th>Image</th>
                                  <th>Status</th>
                                </tr>
                              </thead>

                              <tbody>
                                <% locals.products.forEach?.((product, index) => { %>
                                  <tr>
                                    <td><%= index + 1 %></td>
                                    <td><%= product.name %></td>
                                    <td><%= product.category?.name %></td>
                                    <td>$<%= product.price %></td>
                                    <!-- <td><%= product.description %></td> -->
                                    <td>$<%= product.offerPrice %></td>
                                    <td><%= product.quantity %></td>
                                    <td>
                                      <% product.image.forEach((image) => { %>
                                        <img src="/uploads/<%= image %>" style="width: 50px; height: 50px;">
                                      <% }); %>
                                    </td>
                            
                            
                                      <td>
                                        
                                        <!-- product edit option -->
                                        <a href="/admin/editProduct/<%= product._id %>" class="btn btn-primary">Edit</a>



                                        <!-- product delete option -->
                                        <!-- <form action="/admin/products/<%= product._id %>/delete" method="post" style="display: inline;">
                                          <button type="submit" class="btn btn-danger">Delete</button>
                                        </form> -->
                                    
                                      
                                        <!-- product lit and unlist option -->
                                        <% if (product.status) { %>
                                          <form id="unlistForm_<%= product._id %>" style="display: inline;">
                                              <button type="button" class="btn btn-warning" onclick="unlistProduct('<%= product._id %>')" data-toggle="modal" data-target="#confirmationModal_<%= product._id %>">Unlist</button>
                                          </form>
                                      <% } else { %>
                                          <form id="listForm_<%= product._id %>" style="display: inline;">
                                              <button type="button" class="btn btn-success" onclick="listProduct('<%= product._id %>')" data-toggle="modal" data-target="#confirmationModal_<%= product._id %>">List</button>
                                          </form>
                                      <% } %>

                                  

                                        <!-- <form id="toggleForm_<%= product._id %>" action="/admin/product/<%= product._id %>/toggle" method="post" style="display: inline;">
                                          <% if(product.listed){ %>
                                          <button id="toggleButton_<%= product._id %>"  type="button" onclick="submitForm('<%= product._id %>','<%= product.listed %>','<%= index %>')"  class="btn btn-warning" data-toggle="modal" data-target="#confirmationModal">
                                              <%= product.listed ? 'Unlist' : 'List' %>
                                          </button>
                                          <%}else{%>
                                            <button id="toggleButton_<%= product._id %>"  type="button" onclick="submitForm('<%= product._id %>','<%= product.listed %>','<%= index %>')"  class="btn btn-success" data-toggle="modal" data-target="#confirmationModal">
                                              <%= product.listed ? 'Unlist' : 'List' %>
                                          </button>
                                            <% } %>
                                          <input type="hidden" name="_method" value="PUT">
                                          <input type="hidden" name="listed" value="<%= !product.listed %>">
                                        </form> -->
                                       
                                       
                                      </td>
                                  </tr>
                                <% }); %>
                              </tbody>
                            </table>

                      
                    </div>
                  </div>
                </div>
              </div>


            </div>
          </div>
       



<!-- -------------------------------sumbit button list unlist-------------------------- -->
 
<script>
    async function unlistProduct(productId) {

      console.log("clicked");
        try {
            const response = await fetch(`/admin/products/${productId}/list-unlist`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                throw new Error('Failed to unlist product');
            }

            // Optionally, update the UI to reflect the change (e.g., change button color)
        } catch (error) {
            console.error(error);
            // Handle error
        }
    }

    async function listProduct(productId) {
      console.log("unclicked");
        try {
            const response = await fetch(`/admin/products/${productId}/list-unlist`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                throw new Error('Failed to list product');
            }

            // Optionally, update the UI to reflect the change (e.g., change button color)
        } catch (error) {
            console.error(error);
            // Handle error
        }
    }
</script>






<%- include('../layouts/adminFooter')  %>
        